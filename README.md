# 日報集計アプリ (Sunabaco)

iPad対応の日報×コード体系集計アプリケーションです。Excelファイルから日報データを読み込み、工数集計やレポート生成を行います。

## 機能

### 📊 ダッシュボード
- 工数集計の概要表示
- 工種別集計グラフ
- 規内/規外比率の可視化
- リアルタイムデータ更新

### 📁 データ取込
- Excelファイル（.xlsx, .xls）のアップロード
- ドラッグ&ドロップ対応
- 自動列名検出とマッピング
- データバリデーション
- 重複チェック機能

### 📈 レポート
- 詳細レポート生成
- 時系列分析
- 工種別集計
- フィルタリング機能
- CSV/PDF出力

### 🔧 コード管理
- 工種コードマスタ管理
- 大区分・小区分の階層管理
- コード検索・編集機能

## 技術スタック

- **フロントエンド**: React 18 + TypeScript
- **ビルドツール**: Vite
- **UIライブラリ**: Tailwind CSS
- **グラフ**: Recharts
- **Excel解析**: xlsx
- **テスト**: Vitest + Testing Library

## セットアップ

### 前提条件
- Node.js 18以上
- npm または yarn

### インストール
```bash
# リポジトリのクローン
git clone <repository-url>
cd sunabaco

# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev
```

### 利用可能なスクリプト
```bash
# 開発サーバー起動
npm run dev

# 本番ビルド
npm run build

# プレビュー
npm run preview

# テスト実行
npm run test

# テスト（UI）
npm run test:ui

# テスト（カバレッジ）
npm run test:coverage

# リント
npm run lint
```

## プロジェクト構造

```
src/
├── components/          # 再利用可能なコンポーネント
│   ├── Layout.tsx      # レイアウトコンポーネント
│   └── Sidebar.tsx     # サイドバーコンポーネント
├── contexts/           # React Context
│   └── DataContext.tsx # データ管理コンテキスト
├── pages/              # ページコンポーネント
│   ├── Dashboard.tsx   # ダッシュボード
│   ├── Import.tsx      # データ取込
│   ├── Reports.tsx     # レポート
│   └── Codes.tsx       # コード管理
├── utils/              # ユーティリティ関数
│   ├── excelParser.ts  # Excel解析
│   ├── dataAggregation.ts # データ集計
│   └── errorHandler.ts # エラーハンドリング
├── types/              # TypeScript型定義
│   └── index.ts        # 共通型定義
└── test/               # テストファイル
    ├── setup.ts        # テストセットアップ
    └── testDataGenerator.ts # テストデータ生成
```

## データ形式

### Excelファイル形式
アプリケーションは以下の形式のExcelファイルをサポートしています：

#### 日報データシート（"データ(日報)"）
| 列名 | 説明 | 例 |
|------|------|-----|
| 日付 | 作業日（YYYYMMDD形式） | 20250929 |
| 業者名 | 作業業者名 | ㈲三和工業 |
| 報告者名 | 報告者氏名 | 木村博 |
| 在籍 | 在籍人数 | 10 |
| 雇 | 雇用区分 | G |
| 工事番号 | 工事番号 | S6290 |
| 小区画 | 小区画コード | 110 |
| 小区分 | 小区分コード | 25K |
| 規内 | 規内工数（時間） | 0.6 |
| 規外 | 規外工数（時間） | 0 |
| 計 | 合計工数（時間） | 0.6 |

#### コードマスタシート（"コード"）
| 列名 | 説明 | 例 |
|------|------|-----|
| 大区分 | 大区分コード | 1 |
| 大区分名称 | 大区分名 | 組立 |
| 小区分 | 小区分コード | 25K |
| 小区分名称 | 小区分名 | 配管工事 |
| 備考 | 備考 | - |

## エラーハンドリング

アプリケーションは包括的なエラーハンドリング機能を提供します：

- **ファイル形式エラー**: サポートされていないファイル形式の検出
- **データバリデーション**: 必須フィールドやデータ型の検証
- **解析エラー**: Excelファイルの解析失敗時の適切なエラーメッセージ
- **ネットワークエラー**: 接続問題の検出とユーザー通知

## パフォーマンス最適化

- **メモ化**: useMemoを使用した計算結果のキャッシュ
- **仮想化**: 大量データの効率的な表示
- **遅延読み込み**: 必要に応じたコンポーネントの読み込み
- **バンドル最適化**: Viteによる高速ビルド

## テスト

```bash
# 全テスト実行
npm run test

# テスト（UI）
npm run test:ui

# カバレッジレポート
npm run test:coverage
```

## デプロイ

### 本番ビルド
```bash
npm run build
```

### 静的ファイルの配信
ビルド後、`dist`フォルダの内容をWebサーバーに配置してください。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

1. このリポジトリをフォーク
2. フィーチャーブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add some amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## プロジェクト管理

### ファイル構造の整理

プロジェクトは以下の原則に基づいて整理されています：

#### 📁 保持されるファイル
- **設定ファイル**: `package.json`, `vite.config.ts`, `tsconfig.json` など
- **ソースコード**: `src/` ディレクトリ内のすべてのファイル
- **テストファイル**: `src/**/__tests__/` 内のテストファイル
- **スクリプト**: `scripts/` ディレクトリ内の実行スクリプト
- **静的ファイル**: `public/` ディレクトリ内のアセット
- **ドキュメント**: `README.md`, `要件定義.txt`
- **データファイル**: `test.xlsx`, `解析元.xlsx`

#### 🗑️ 削除されたファイル
- `test_data.js` - 開発・テスト用の一時ファイル
- `test-react-app.html` - 開発・テスト用の一時HTMLファイル

#### 🧹 クリーンアップの原則
1. **一時ファイルの削除**: 開発中に作成されたテスト用ファイルは削除
2. **重複ファイルの解消**: 同じ機能を持つファイルは統合
3. **不要な依存関係の除去**: 使用されていないパッケージは削除
4. **ログファイルの管理**: 本番環境では不要なログファイルを削除

### コード品質管理

#### 🔍 品質チェック
```bash
# リンターの実行
npm run lint

# 型チェックの実行
npx tsc --noEmit

# テストの実行
npm run test:run

# 全体的な品質チェック
./scripts/test-all.sh
```

#### 📊 メトリクス
- **TypeScript使用率**: 100%
- **テストカバレッジ**: 主要機能をカバー
- **リンターエラー**: 0件
- **型エラー**: 0件

### メンテナンス

#### 🔄 定期的なメンテナンス
1. **依存関係の更新**: 月1回の依存関係チェック
2. **セキュリティパッチ**: 脆弱性の確認と修正
3. **パフォーマンス監視**: ビルド時間とバンドルサイズの監視
4. **コードレビュー**: プルリクエスト時の品質チェック

#### 🚀 デプロイ前チェックリスト
- [ ] 全テストが通過している
- [ ] リンターエラーがない
- [ ] 型エラーがない
- [ ] ビルドが成功する
- [ ] 不要なファイルが削除されている
- [ ] ドキュメントが最新である

## サポート

問題や質問がある場合は、GitHubのIssuesページで報告してください。
